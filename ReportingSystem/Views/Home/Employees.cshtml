@using ReportingSystem.Properties;


<head>
    <title>Співробітники</title>
</head>

@{
    ViewData["Title"] = "Співробітники";
}

<div class="text-center">
    <h1 class="display-4">Співробітники</h1>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.7.8/dist/vue.js"></script>
<script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<link rel="stylesheet" href="~/css/Employees.css" asp-append-version="true" />
@*---------------------------------------------------------------------------------------------------------------------*@

<div class="container" id="Employees">
    <div class="accordion" id="accordionExample" v-if="employees.length !== 1">
        @*---------------------------------------------------------------------------------------------------------------------*@
        @* Модальне вікно*@
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">{{modalTitle}}:</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрити"></button>
                    </div>
                    <div class="modal-body">

                        @*Для редагування співробітника*@
                        <div v-if="modalType === 2">
                            <div class="form-group">
                                <label class="form-label">Назва</label>
                                <input class="form-control" type="text" v-model="editUserName" />
                                <label class="form-label">Адреса</label>
                            </div>
                        </div>
                        @*Для створення співробітника*@
                        <div v-if="modalType === 1">
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" v-model="useOpenDataBot" id="useOpenDataBot">
                                <label class="form-check-label" for="useOpenDataBot">Створити з допомогою OpenDataBot</label>
                            </div>
                            <div class="form-group" v-if="useOpenDataBot == false">
                                <label class="form-label">Назва</label>
                                <input class="form-control" placeholder="Введіть назву" type="text" v-model="editUserName" />
                            </div>
                            <div v-else>
                                <label class="form-label">ЄДРПУ</label>
                                <input class="form-control" placeholder="Введіть ЄДРПУ" type="text" v-model="editEDRPU" />
                            </div>
                        </div>

                        <p :class="{ 'red-text': modalEmployeeActive }">{{ modalOperation }}</p>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрити</button>
                        
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" v-if="modalType === 1 && useOpenDataBot == false" v-on:click="confirmCreateUser()">Підтвердити</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" v-if="modalType === 2" v-on:click="confirmEditUser()">Підтвердити</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" v-if="modalType === 3" v-on:click="confirmArchiveUser()">Підтвердити</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" v-if="modalType === 4" v-on:click="confirmDeleteUser()">Підтвердити</button>
                    </div>
                </div>
            </div>
        </div>
        @*---------------------------------------------------------------------------------------------------------------------*@
        <div class="row mb-3">
            <div class="col">
                <div class="btn-group d-flex justify-content-between">
                    <button type="button" class="btn btn-secondary col-sm-6 ms-2" data-bs-toggle="modal" data-bs-target="#staticBackdrop" v-on:click="toggleModal(1, -1)">Додати співробітника</button>
                </div>
            </div>
        </div>

        <div style="display: flex; align-items: center;">
            <select class="form-select mb-3" aria-label="Default select example" v-on:change="getSelectedCompany($event)">
                <option selected>Виберіть компанію</option>
                <option v-for="company in companies" :value="company.id">{{ company.name }}</option>
            </select>

            <div class="form-check mb-3" style="margin-left: 20px;">
                <input class="form-check-input" type="checkbox" id="flexCheckIndeterminate" v-on:click="Init()" v-model="saveCompany">
                <label class="form-check-label" for="flexCheckIndeterminate">
                    Запам'ятати компанію
                </label>
            </div>
        </div>

        <div style="display: flex; align-items: center;">
           
            <input class="form-control" v-model="searchQuery" type="text" placeholder="Пошук...">

            <div class="form-check mb-3" style="margin-left: 20px;">
                <input class="form-check-input" type="checkbox" v-model="showArchive" v-on:change="closeAllAccordions()">
                <label class="form-check-label" for="showArchive">
                    Архівні
                </label>
            </div>
        </div>

        @*---------------------------------------------------------------------------------------------------------------------*@
        <div class="container" v-if="countFilteredEmployees > 10">
            <div class="row">
                <div class="btn-toolbar justify-content-between" role="toolbar" aria-label="Toolbar with button groups">
                    <div class="btn-group mb-3 mt-3 d-flex justify-content-start">
                        <button type="button" class="btn btn-default" v-bind:class="{active: itemsPerPage == 10}" v-on:click="setItemsPerPage(10)">10</button>
                        <button type="button" v-if="countFilteredEmployees > 10" class="btn btn-default" v-bind:class="{active: itemsPerPage == 15}" v-on:click="setItemsPerPage(15)">15</button>
                        <button type="button" v-if="countFilteredEmployees > 15" class="btn btn-default" v-bind:class="{active: itemsPerPage == 20}" v-on:click="setItemsPerPage(20)">20</button>
                    </div>
                    <div class="btn-group mb-3 mt-3 d-flex justify-content-end">
                        <button type="button" class="btn btn-light" v-on:click="prevBatch()" data-bs-toggle="tooltip" data-bs-placement="top" title="Попередні" :style="{ visibility: pageCur !== 1 ? 'visible' : 'hidden' }"><<</button>
                        <button type="button" class="btn btn-light" v-on:click="firstBatch()" data-bs-toggle="tooltip" data-bs-placement="top" title="На початок">{{pageCur}}</button>
                        <button type="button" class="btn btn-light" v-on:click="nextBatch()" data-bs-toggle="tooltip" data-bs-placement="top" title="Наступні" :style="{ visibility: pageCur < pageCount ? 'visible' : 'hidden' }">>></button>
                    </div>
                </div>
            </div>
        </div>
        @*---------------------------------------------------------------------------------------------------------------------*@
        
        @*<div style="margin-top: 1em;"></div>
        <div v-for="(employee, index) in filteredEmployees" :key="index" class="accordion-item">
            <h2 class="accordion-header" :id="'heading' + index">
                <button class="accordion-button" type="button" :data-bs-toggle="'collapse'" :data-bs-target="'#collapse' + index" :aria-controls="'collapse' + index">
                    {{ employee.firstName }} {{employee.secondName}} {{employee.thirdName}}
                </button>
            </h2>
            <div :id="'collapse' + index" class="accordion-collapse collapse" :aria-labelledby="'heading' + index" data-bs-parent="#Employees">
                -------
            </div>
        </div>*@
        <table class="table">
            <tbody>
                <tr>
                    <td>
                        <div style="margin-top: 1em;"></div>
                        <div v-for="(employee, index) in filteredEmployees" :key="index" class="accordion-item">
                            <h2 class="accordion-header" :id="'heading' + index">
                                <button class="accordion-button" v-on:click="setIndexEmployee(index)" type="button" :data-bs-toggle="'collapse'" :data-bs-target="'#collapse' + index" :aria-controls="'collapse' + index">
                                    {{ employee.firstName }} {{employee.secondName}} {{employee.thirdName}}
                                </button>
                            </h2>
                            <div :id="'collapse' + index" class="accordion-collapse collapse" :aria-labelledby="'heading' + index" data-bs-parent="#Employees">
                                -------
                            </div>
                        </div>
                    </td>
                    <td>
                        <table>
                            <tbody>
                                <tr>
                                    <td><strong>Повне ім'я</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].firstName}} {{filteredEmployees[indexEmployee].secondName}} {{filteredEmployees[indexEmployee].thirdName}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Дата народження</strong></td>
                                    <td>{{showFormatDate(filteredEmployees[indexEmployee].birthDate)}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Адреса проживання</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].addressFact}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Адреса реєстрації</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].addressReg}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Дата призначення</strong></td>
                                    <td>{{showFormatDate(filteredEmployees[indexEmployee].assignmentDate)}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Дата прийому на роботу</strong></td>
                                    <td>{{showFormatDate(filteredEmployees[indexEmployee].workStartDate)}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Дата закінчення роботи</strong></td>
                                    <td>{{showFormatDate(filteredEmployees[indexEmployee].workEndDate)}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Посада</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].position.namePosition}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Зарплата</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].salary}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Податковий номер</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].taxNumber}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Електронна пошта (особиста)</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].emailSelf}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Електронна пошта (робоча)</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].emailWork}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Телефон (особистий)</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].phoneSelf}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Телефон (робочий)</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].phoneWork}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Статус</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].status.employeeStatusName}}</td>
                                </tr>
                                <tr>
                                    <td><strong>Роль</strong></td>
                                    <td>{{filteredEmployees[indexEmployee].rol.rolName}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>
    <div v-else>
        <div style="margin-top: 50px; margin-bottom: 50px;">
            <div class="text-center">
                <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>
</div>
@*---------------------------------------------------------------------------------------------------------------------*@
<script src="~/js/Employees.js" asp-append-version="true"></script>