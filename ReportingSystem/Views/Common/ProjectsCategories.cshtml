@using ReportingSystem.Properties;


<head>
    <title>123</title>
</head>

@{
    ViewData["Title"] = "Категорії проектів";
}

<div class="text-center">
    <h1 class="display-4">Категорії проектів</h1>
</div>


<script src="https://cdn.jsdelivr.net/npm/vue@2.7.8/dist/vue.js"></script>
<script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<link rel="stylesheet" href="~/css/ProjectsCategories.css" asp-append-version="true" />

<div class="container" id="ProjectsCategories">

    <div class="row mb-3">
        <div class="col">

            <div class="btn-group d-flex justify-content-between">
                <button type="button" class="btn btn-secondary col-sm-6 ms-2" data-bs-toggle="modal" data-bs-target="#staticBackdrop" v-on:click="toggleModal(1,-1, -1, -1, -1)">
                    Додати Категорії
                </button>
            </div>
        </div>
    </div>

    <div class="accordion" v-if="categoriesLevel1.length !== 1">

        @* Модальне вікно *@
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">{{modalTitle}}:</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрити"></button>
                    </div>
                    <div class="modal-body">

                        @*Для редагування категорії*@
                        <div v-if="modalType === 2">
                            <div class="form-group">
                                <label class="form-label">{{modalName}}</label>
                                <input class="form-control" placeholder="Введіть нову назву категорії" type="text" v-model="editCategoryName" />
                            </div>
                        </div>

                        @*Для додавання категорії*@
                        <div v-if="modalType === 1">
                            <div class="form-group">
                                <input class="form-control" placeholder="Введіть назву нової категорії" type="text" v-model="editCategoryName" />
                            </div>
                        </div>

                        <p :class="{ 'red-text': modalCategoryUsed }">{{ modalOperation }}</p>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрити</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" v-if="modalType === 1" v-on:click="confirmCreateCategory()">Підтвердити</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" v-if="modalType === 2" v-on:click="confirmEditCategory()">Підтвердити</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" v-if="modalType === 3" v-on:click="confirmDeleteCategory()">Підтвердити</button>
                    </div>
                </div>
            </div>
        </div>

        

        <div style="display: flex; align-items: center;" v-if="rol === 'Developer' || rol === 'DevAdministrator'">
            <select class="form-select mb-3" aria-label="Default select example" v-on:change="getSelectedCustomer($event)" v-model="selectedCustomerId">
                <option v-for="customer in customers" :value="customer.id">{{ customer.firstName }} {{ customer.secondName }} {{ customer.thirdName }} {{ customer.email }}</option>
            </select>
        </div>

        <div style="display: flex; align-items: center;" v-if="rol === 'Developer' || rol === 'DevAdministrator' || rol === 'Customer'">
            <select class="form-select mb-3" aria-label="Default select example 1" v-on:change="getSelectedCompany($event)" v-model="selectedCompanyId">
                <option v-for="company in companies" :value="company.id">{{ company.name }}</option>
            </select>
        </div>

        <div class="mb-3">
            <!-- Поле введення для пошуку -->
            <input v-model="searchQueryCategory" type="text" class="form-control" placeholder="Пошук...">
        </div>

        <div class="container" v-if="countFilteredCategory > 10">
            <div class="row">
                <div class="btn-toolbar justify-content-between" role="toolbar" aria-label="Toolbar with button groups">
                    <div class="btn-group mb-3 mt-3 d-flex justify-content-start">
                        <button type="button" class="btn btn-default" v-bind:class="{active: itemsPerPage == 10}" v-on:click="setItemsPerPage(10)">10</button>
                        <button type="button" v-if="countFilteredCategory > 10" class="btn btn-default" v-bind:class="{active: itemsPerPage == 15}" v-on:click="setItemsPerPage(15)">15</button>
                        <button type="button" v-if="countFilteredCategory > 15" class="btn btn-default" v-bind:class="{active: itemsPerPage == 20}" v-on:click="setItemsPerPage(20)">20</button>
                    </div>
                    <div class="btn-group mb-3 mt-3 d-flex justify-content-end">
                        <button type="button" class="btn btn-light" v-on:click="prevBatch()" data-bs-toggle="tooltip" data-bs-placement="top" title="Попередні" :style="{ visibility: pageCur !== 1 ? 'visible' : 'hidden' }"><<</button>
                        <button type="button" class="btn btn-light" v-on:click="firstBatch()" data-bs-toggle="tooltip" data-bs-placement="top" title="На початок">{{pageCur}}</button>
                        <button type="button" class="btn btn-light" v-on:click="nextBatch()" data-bs-toggle="tooltip" data-bs-placement="top" title="Наступні" :style="{ visibility: pageCur < pageCount ? 'visible' : 'hidden' }">>></button>
                    </div>
                </div>
            </div>
        </div>

        @*<div class="container">
            <div class="row">
                <div class="btn-toolbar justify-content-between" role="toolbar" aria-label="Toolbar with button groups">
                    <div class="btn-group mb-3 mt-3 d-flex justify-content-start">
                        <button type="button" class="btn btn-default" v-bind:class="{active: itemsPerPage == 10}" v-on:click="setItemsPerPage(10)">10</button>
                        <button type="button" class="btn btn-default" v-bind:class="{active: itemsPerPage == 15}" v-on:click="setItemsPerPage(15)">15</button>
                        <button type="button" class="btn btn-default" v-bind:class="{active: itemsPerPage == 20}" v-on:click="setItemsPerPage(20)">20</button>
                    </div>
                    <div class="btn-group mb-3 mt-3 d-flex justify-content-end">
                        <button type="button" class="btn btn-light" v-on:click="prevBatch()" data-bs-toggle="tooltip" data-bs-placement="top" title="Попередні"><<</button>
                        <button type="button" class="btn btn-light" v-on:click="firstBatch()" data-bs-toggle="tooltip" data-bs-placement="top" title="На початок">{{pageCur}}</button>
                        <button type="button" class="btn btn-light" v-on:click="nextBatch()" data-bs-toggle="tooltip" data-bs-placement="top" title="Наступні">>></button>
                    </div>
                </div>
            </div>
        </div>*@

        <div style="margin-top: 1em;"></div>

        <div v-for="(category, indexLevel0) in filteredCategory" :key="indexLevel0" class="accordion-item lv1">
            <h2 class="accordion-header" :id="'heading' + indexLevel0">
                <button class="accordion-button" type="button" :data-bs-toggle="'collapse'" :data-bs-target="'#collapse' + indexLevel0" :aria-controls="'collapse' + indexLevel0">
                    {{ category.name }}
                </button>
            </h2>
            <div :id="'collapse' + indexLevel0" class="accordion-collapse collapse" :aria-labelledby="'heading' + indexLevel0" data-bs-parent="#ProjectsCategories">
                <div class="accordion-body">
                    <table class="table">
                        <tbody>
                            <tr>
                                <td colspan="2" class="text-left">
                                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Редагувати категорію" v-on:click="toggleModal(2,indexLevel0, -1, -1, -1)">ε</button>&nbsp;
                                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Видалити категорію" v-on:click="toggleModal(3,indexLevel0, -1, -1, -1)">-</button>
                                    <button type="button" class="btn btn-secondary float-end" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Додати підкатегорію" v-on:click="toggleModal(1,indexLevel0, -1, -1, -1)">+</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div v-if="category.categoriesLevel1">
                        <div v-for="(categoryLevel1, indexLevel1) in category.categoriesLevel1" :key="indexLevel1" class="accordion-item lv2">
                            <h2 class="accordion-header" :id="'heading' + indexLevel0 + indexLevel1">
                                <button class="accordion-button" type="button" :data-bs-toggle="'collapse'" :data-bs-target="'#collapse' + indexLevel0 + indexLevel1" :aria-controls="'collapse' + indexLevel0 + indexLevel1">
                                    {{ categoryLevel1.name }}
                                </button>
                            </h2>
                            <div :id="'collapse' + indexLevel0 + indexLevel1" class="accordion-collapse collapse" :aria-labelledby="'heading' + indexLevel0 + indexLevel1" :data-bs-parent="'#collapse' + indexLevel0">
                                <div class="accordion-body">
                                    <table class="table">
                                        <tbody>
                                            <tr>
                                                <td colspan="2" class="text-left">
                                                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Редагувати категорію" v-on:click="toggleModal(2,indexLevel0, indexLevel1, -1, -1)">ε</button>&nbsp;
                                                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Видалити категорію" v-on:click="toggleModal(3,indexLevel0, indexLevel1, -1, -1)">-</button>
                                                    <button type="button" class="btn btn-secondary float-end" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Додати підкатегорію" v-on:click="toggleModal(1,indexLevel0, indexLevel1, -1, -1)">+</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div v-if="categoryLevel1.categoriesLevel2">
                                        <div v-for="(categoryLevel2, indexLevel2) in categoryLevel1.categoriesLevel2" :key="indexLevel2" class="accordion-item lv3">
                                            <h2 class="accordion-header" :id="'heading' + indexLevel0 + indexLevel1 + indexLevel2">
                                                <button class="accordion-button" type="button" :data-bs-toggle="'collapse'" :data-bs-target="'#collapse' + indexLevel0 + indexLevel1 + indexLevel2" :aria-controls="'collapse' + indexLevel0 + indexLevel1 + indexLevel2">
                                                    {{ categoryLevel2.name }}
                                                </button>
                                            </h2>
                                            <div :id="'collapse' + indexLevel0 + indexLevel1 + indexLevel2" class="accordion-collapse collapse" :aria-labelledby="'heading' + indexLevel0 + indexLevel1 + indexLevel2" :data-bs-parent="'#collapse' + indexLevel0 + indexLevel1">
                                                <div class="accordion-body">
                                                    <table class="table">
                                                        <tbody>
                                                            <tr>
                                                                <td colspan="2" class="text-left">
                                                                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Редагувати категорію" v-on:click="toggleModal(2,indexLevel0, indexLevel1, indexLevel2, -1)">ε</button>&nbsp;
                                                                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Видалити категорію" v-on:click="toggleModal(3,indexLevel0, indexLevel1, indexLevel2, -1)">-</button>
                                                                    <button type="button" class="btn btn-secondary float-end" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Додати підкатегорію" v-on:click="toggleModal(1,indexLevel0, indexLevel1, indexLevel2, -1)">+</button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                    <div v-if="categoryLevel2.categoriesLevel3">
                                                        <div v-for="(categoryLevel3, indexLevel3) in categoryLevel2.categoriesLevel3" :key="indexLevel3" class="accordion-item lv4">
                                                            <h2 class="accordion-header" :id="'heading' + indexLevel0 + indexLevel1 + indexLevel2 + indexLevel3">
                                                                <button class="accordion-button" type="button" :data-bs-toggle="'collapse'" :data-bs-target="'#collapse' + indexLevel0 + indexLevel1 + indexLevel2 + indexLevel3" :aria-controls="'collapse' + indexLevel0 + indexLevel1 + indexLevel2 + indexLevel3">
                                                                    {{ categoryLevel3.name }}
                                                                </button>
                                                            </h2>
                                                            <div :id="'collapse' + indexLevel0 + indexLevel1 + indexLevel2 + indexLevel3" class="accordion-collapse collapse" :aria-labelledby="'heading' + indexLevel0 + indexLevel1 + indexLevel2 + indexLevel3" :data-bs-parent="'#collapse' + indexLevel0 + indexLevel1 + indexLevel2">
                                                                <div class="accordion-body">
                                                                    <table class="table">
                                                                        <tbody>
                                                                            <tr>
                                                                                <td colspan="2" class="text-left">
                                                                                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Редагувати категорію" v-on:click="toggleModal(2,indexLevel0, indexLevel1, indexLevel2, indexLevel3)">ε</button>&nbsp;
                                                                                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" title="Видалити категорію" v-on:click="toggleModal(3,indexLevel0, indexLevel1, indexLevel2, indexLevel3)">-</button>
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div v-else>
        <div style="margin-top: 50px; margin-bottom: 50px;">
            <div class="text-center">
                <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>
</div>

                                                        
<script src="~/js/ProjectsCategories.js" asp-append-version="true"></script>